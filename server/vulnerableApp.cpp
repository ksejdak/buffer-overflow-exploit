#include <iostream>
#include <cstring>
#include <cstdlib>

#define REMOTE_DATA_SIZE    512
#define INTERNAL_DATA_SIZE  16

int receive(char* buffer, int bufferSize);

void copyData(char* data, int size)
{
    char buffer[INTERNAL_DATA_SIZE];

    std::cout << "Processing... ";
    memcpy(buffer, data, size);
    std::cout << "DONE" << std::endl;
}

int main(int argc, char* argv[])
{
    while(true)
    {
        std::cout << "Waiting for client..." << std::endl;
        char remoteData[REMOTE_DATA_SIZE];
        int receiveResult = receive(remoteData, REMOTE_DATA_SIZE);
        if(receiveResult < 0)
        {
            std::cout << "receive failed with error: " << receiveResult << std::endl;
            return 1;
        }
        
        std::cout << "Received " << receiveResult << " bytes" << std::endl;
        copyData(remoteData, receiveResult);
        std::cout << std::endl;
    }

    return 0;
}